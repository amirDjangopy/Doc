# مستندات API بخش مدیریت کاربران

## معرفی کلی

این سرویس وظیفه‌ی مدیریت کاربران را برعهده دارد:  
- ثبت‌نام  
- ورود و خروج  
- مشاهده و ویرایش پروفایل  
- حذف حساب کاربری  

این سیستم با **Django REST Framework** پیاده‌سازی شده و از **JWT** برای احراز هویت استفاده می‌کند. امنیت، مقیاس‌پذیری و تفکیک سطح دسترسی در طراحی آن در نظر گرفته شده است.

---

## تکنولوژی‌های استفاده‌شده

- **زبان:** Python 3.12  
- **فریم‌ورک بک‌اند:** Django 5.2  
- **REST API:** Django REST Framework  
- **احراز هویت:** JWT (JSON Web Token)  
- **پایگاه داده:** PostgreSQL (پروداکشن) / SQLite (توسعه)  
- **تنظیمات محیطی:** python-decouple + فایل `.env`

---

## مسیرهای API

| مسیر                         | متد   | توضیح                        | احراز هویت          | سطح دسترسی                |
|------------------------------|--------|-----------------------------|----------------------|---------------------------|
| `/api/v1/users/`             | POST   | ثبت‌نام کاربر جدید           | نیاز ندارد           | عمومی (Public)            |
| `/api/v1/auth/login/`        | POST   | ورود به سیستم (Login)        | نیاز ندارد           | عمومی                     |
| `/api/v1/auth/logout/`       | POST   | خروج از سیستم (Logout)       | نیاز دارد            | کاربران احرازشده          |
| `/api/v1/users/`             | GET    | دریافت لیست کاربران          | نیاز دارد            | فقط مدیر (Admin)          |
| `/api/v1/users/{id}/`        | GET    | دریافت پروفایل کاربر خاص     | نیاز دارد            | صاحب حساب یا مدیر         |
| `/api/v1/users/{id}/`        | PUT    | ویرایش اطلاعات کاربر         | نیاز دارد            | صاحب حساب یا مدیر         |
| `/api/v1/users/{id}/`        | DELETE | حذف حساب کاربر               | نیاز دارد            | فقط مدیر                  |

---


## قالب درخواست و پاسخ‌ها

### ثبت‌نام کاربر (POST `/api/v1/users/`)

**بدنه درخواست (JSON):**
```
{
  "username": "string",
  "email": "string",
  "password": "string"
}
username: اجباری، یکتا، بین 3 تا 150 کاراکتر

email: اجباری، با فرمت ایمیل معتبر

password: اجباری، حداقل 8 کاراکتر، رمز عبور به صورت هش شده ذخیره می‌شود

```

پاسخ موفق (۲۰۱ Created):
```
{
  "id": عدد صحیح,
  "username": "string",
  "email": "string",
  "date_joined": "تاریخ و زمان به فرمت ISO8601"
}
```

ورود به سیستم (POST /api/v1/auth/login/)
بدنه درخواست:
```
{
  "username": "string",
  "password": "string"
}
پاسخ موفق (۲۰۰ OK):
```

```
{
  "access": "توکن دسترسی JWT",
  "refresh": "توکن تجدید JWT"
}
```

## احراز هویت و مجوزها
از JWT برای امنیت استفاده شده است.

مسیرهای محافظت شده نیاز به هدر Authorization: Bearer <access_token> دارند.

مجوزها با استفاده از دسترسی‌های DRF مانند IsAuthenticated و مجوزهای سفارشی برای مالکیت و دسترسی مدیر کنترل می‌شوند.

اعتبارسنجی و امنیت
رمز عبورها با استفاده از مکانیزم هش داخلی جنگو (make_password()) و الگوریتم PBKDF2 ذخیره می‌شوند.

تکراری نبودن ایمیل و نام کاربری در سطح پایگاه داده و اعتبارسنجی انجام می‌شود.

محدودیت نرخ درخواست (Rate Limiting) روی لاگین برای جلوگیری از حملات بروت‌فورس اعمال شده است.

در محیط پروداکشن، تمام ترافیک API باید با HTTPS ارسال شود.

## مدل‌های پایگاه داده (خلاصه)
```
class User(AbstractUser):
    email = models.EmailField(unique=True)
    # فیلدهای اضافی در صورت نیاز قابل اضافه هستند
```
  
## مدیریت خطا
کدهای استاندارد HTTP (۴۰۰، ۴۰۱، ۴۰۳، ۴۰۴، ۵۰۰) در پاسخ‌ها بازگردانده می‌شود.

قالب پاسخ خطا:
```
{
  "detail": "توضیح خطا"
}
```
## نکات مربوط به استقرار
تنظیمات محیطی در فایل .env نگهداری می‌شود (مانند DEBUG، DATABASE_URL، ALLOWED_HOSTS، SECRET_KEY).

اتصال به پایگاه داده از طریق متغیرهای محیطی تنظیم می‌شود.

در پروداکشن باید DEBUG=False تنظیم شود و ALLOWED_HOSTS به درستی مقداردهی گردد.




